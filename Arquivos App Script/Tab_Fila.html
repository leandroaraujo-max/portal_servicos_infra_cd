<!-- Tab_Fila.html - Aba de Fila de Atendimento -->
<!-- v1.7.0: Componente modular extraído do AppsScript_Web_Index.html -->

<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h2 class="text-lg font-medium text-gray-900">Últimas Solicitações</h2>
        <button @click="loadQueue" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
            <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Atualizar
        </button>
    </div>

    <!-- Filtros da Fila -->
    <div class="p-4 bg-gray-50 border-b border-gray-200">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Filial</label>
                <select v-model="queueFilters.filial"
                    class="w-full text-sm border-gray-300 rounded-md border p-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="">Todas as Filiais</option>
                    <option v-for="filial in uniqueQueueFilials" :key="filial" :value="filial">{{ filial }}</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Status</label>
                <select v-model="queueFilters.status"
                    class="w-full text-sm border-gray-300 rounded-md border p-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="">Todos os Status</option>
                    <option value="PENDENTE">PENDENTE</option>
                    <option value="SUCESSO">SUCESSO</option>
                    <option value="ERRO">ERRO</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Analista</label>
                <select v-model="queueFilters.analista"
                    class="w-full text-sm border-gray-300 rounded-md border p-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="">Todos os Analistas</option>
                    <option v-for="analista in uniqueQueueAnalysts" :key="analista" :value="analista">{{ analista }}
                    </option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Buscar</label>
                <input type="text" v-model="queueFilters.search" placeholder="Nome ou usuário..."
                    class="w-full text-sm border-gray-300 rounded-md border p-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div v-if="queueLoading" class="flex items-center justify-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    </div>

    <!-- Tabela da Fila -->
    <div v-if="!queueLoading" class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-4 text-left text-xs font-bold text-gray-600 uppercase">ID</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Data</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Filial</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Colaborador</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Analista</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Tipo</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase">Status</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
                <tr v-for="item in paginatedQueue" :key="item.id || (item.data + item.user)" class="hover:bg-gray-50">
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-mono text-gray-600 bg-gray-50">
                        #{{ item.id || '-' }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ formatDate(item.data) }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.filial }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ toTitleCase(item.nome) }}</div>
                        <div class="text-xs text-gray-500">{{ item.user }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ item.analista }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span :class="{
                                'bg-blue-100 text-blue-800': item.tipo === 'RESET' || item.tipo === 'RESET_SENHA',
                                'bg-green-100 text-green-800': item.tipo === 'UNLOCK' || item.tipo === 'DESBLOQUEIO_CONTA' || item.tipo === 'DESBLOQUEIO',
                                'bg-purple-100 text-purple-800': item.tipo === 'MIRROR' || item.tipo === 'ESPELHO_USUARIO',
                                'bg-orange-100 text-orange-800': item.tipo === 'WMS_PRINT_CLEAN'
                            }"
                            class="px-2 inline-flex text-[10px] leading-5 font-bold rounded-full border border-current opacity-80 uppercase tracking-tighter">
                            {{ item.tipo || 'RESET' }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span
                            :class="{'bg-yellow-100 text-yellow-800': item.status === 'PENDENTE', 'bg-green-100 text-green-800': item.status === 'SUCESSO', 'bg-red-100 text-red-800': item.status === 'ERRO'}"
                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">{{ item.status
                            }}</span>
                    </td>
                </tr>
                <tr v-if="paginatedQueue.length === 0">
                    <td colspan="7" class="px-6 py-10 text-center text-gray-400">Nenhum registro encontrado com os
                        filtros selecionados.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Paginação -->
    <div v-if="!queueLoading && filteredQueue.length > 0"
        class="p-4 bg-gray-50 border-t border-gray-200 flex justify-center items-center">
        <div class="text-xs font-bold text-blue-600 uppercase tracking-widest">
            Total Geral na Fila: {{ filteredQueue.length }} Colaboradores
        </div>
    </div>
</div>